<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PromptGen Web</title>
    <link rel="stylesheet" href="https://use.typekit.net/oxd7xnd.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/ai-chat.css">
    <link rel="stylesheet" href="/css/prompt-generation.css">
    <link rel="stylesheet" href="/css/prompt-history.css">
    <link rel="stylesheet" href="/css/global-ai-model.css">
    <link rel="stylesheet" href="/css/top-nav-model-selector.css">
    <link rel="stylesheet" href="/css/openrouter-key-manager.css">
    <link rel="stylesheet" href="/css/template-builder.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Auth Screen -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <div class="auth-logo">
                <i class="fas fa-magic"></i>
            </div>
            <h1>PromptGen</h1>
            <p class="auth-subtitle">AI-Powered Prompt Generation</p>

            <div class="auth-tabs">
                <button class="tab-btn active" data-tab="login">Login</button>
                <button class="tab-btn" data-tab="register">Register</button>
            </div>

            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <i class="fas fa-envelope form-icon"></i>
                    <input type="email" id="login-email" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <i class="fas fa-lock form-icon"></i>
                    <input type="password" id="login-password" placeholder="Password" required>
                </div>
                <div id="login-error" class="error-message hal-message"></div>
                <button type="submit" class="btn-primary">Login</button>
            </form>

            <form id="register-form" class="auth-form hidden">
                <div class="form-group">
                    <i class="fas fa-user form-icon"></i>
                    <input type="text" id="register-name" placeholder="Name" required>
                </div>
                <div class="form-group">
                    <i class="fas fa-envelope form-icon"></i>
                    <input type="email" id="register-email" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <i class="fas fa-lock form-icon"></i>
                    <input type="password" id="register-password" placeholder="Password" required>
                </div>
                                <div id="register-error" class="error-message hal-message"></div>
                <button type="submit" class="btn-primary">Register</button>
            </form>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="main-screen" class="screen hidden">
        <!-- Top Header -->
        <header class="app-header">
            <div class="header-left">
                <h1>PromptGen</h1>
            </div>
            <div class="header-right">
                <!-- Top Nav Model Selector -->
                <div id="top-nav-model-selector"></div>
                
                <div class="user-profile" id="header-user-profile" style="cursor: pointer;" title="View Profile & Settings">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <div id="header-user-name">User</div>
                        <div id="header-user-email" style="font-size: 11px; color: var(--text-muted);"></div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="app-container">
            <!-- Left sidebar menu -->
            <div class="sidebar">
                <ul class="menu">
                    <li class="menu-item active" data-module="dashboard-module">
                        <i class="fas fa-home"></i>Dashboard
                    </li>
                    <li class="menu-item" data-module="template-builder-module">
                        <i class="fas fa-copy"></i>Template Builder
                    </li>
                    <li class="menu-item" data-module="prompt-importer-module">
                        <i class="fas fa-download"></i>Prompt Importer
                    </li>
                    <li class="menu-item" data-module="ai-chat-assistant-module">
                        <i class="fas fa-comments"></i>AI Chat Assistant
                    </li>
                    <li class="menu-item" data-module="prompt-generation-module">
                        <i class="fas fa-tasks"></i>Prompt Generation
                    </li>
                </ul>
                <div class="sidebar-footer">
                    <div class="user-profile" id="sidebar-user-profile" style="cursor: pointer;" title="View Profile & Settings">
                        <i class="fas fa-user-circle"></i>
                        <div>
                            <div id="user-name">User</div>
                            <div id="user-email" style="font-size: 11px; color: var(--text-muted);"></div>
                        </div>
                    </div>
                    <button class="btn-logout" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
            
            <!-- Main content area -->
            <div class="module-panel">
                <!-- Dashboard module -->
                <div id="dashboard-module" class="module-content active">
                    <div class="module-header">
                        <h2>Dashboard</h2>
                    </div>
                    <div class="content-card">
                        <h3>Quick Navigation</h3>
                        <div class="quick-navigation">
                            <button class="action-button large-button" data-module="prompt-history-module"><i class="fas fa-history"></i>Prompt History</button>
                            <button class="action-button large-button" data-module="template-builder-module"><i class="fas fa-code"></i>Template Builder</button>
                            <button class="action-button large-button" data-module="prompt-importer-module"><i class="fas fa-download"></i>Prompt Importer</button>
                            <button class="action-button large-button" data-module="ai-chat-assistant-module"><i class="fas fa-comments"></i>AI Chat Assistant</button>
                            <button class="action-button large-button" data-module="prompt-generation-module"><i class="fas fa-tasks"></i>Prompt Generation</button>
                            <!-- <button class="action-button large-button" data-module="style-library-module"><i class="fas fa-palette"></i>Style Library</button> -->
                            <!-- <button class="action-button large-button" data-module="settings-module"><i class="fas fa-cog"></i>Settings</button> -->
                        </div>
                    </div>
                    <div class="content-card">
                        <h3><i class="fas fa-history"></i> Recent Prompts</h3>
                        <div id="recent-prompts-list" class="recent-prompts-container">
                            <div class="placeholder">Your recent prompts will appear here</div>
                        </div>
                    </div>
                </div>
                
                <!-- Prompt History module -->
                <div id="prompt-history-module" class="module-content">
                    <div class="module-header">
                        <h2>Prompt History</h2>
                        <p class="module-description">View, search, and reuse your previously submitted prompts</p>
                    </div>
                    <div class="content-card">
                        <div class="history-controls">
                            <input type="text" id="history-search" placeholder="Search prompts..." class="search-input">
                            <select id="history-filter" class="filter-select">
                                <option value="all">All Services</option>
                                <option value="ideogram-browser">Ideogram</option>
                                <option value="midjourney-browser">Midjourney</option>
                                <option value="ideogram-browser-batch">Ideogram Batch</option>
                                <option value="midjourney-browser-batch">Midjourney Batch</option>
                            </select>
                            <button id="refresh-history" class="action-button"><i class="fas fa-sync"></i> Refresh</button>
                        </div>
                        <div id="history-list" class="history-list">
                            <div class="loading">Loading history...</div>
                        </div>
                        <div class="pagination-controls">
                            <button id="prev-page" class="pagination-btn" disabled><i class="fas fa-chevron-left"></i> Previous</button>
                            <span id="page-info">Page 1</span>
                            <button id="next-page" class="pagination-btn" disabled>Next <i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
                
                <!-- Template Builder module -->
                <div id="template-builder-module" class="module-content">
                    <div class="module-header">
                        <h2>Template Builder</h2>
                    </div>
                    <div class="content-card">
                        <h3>Template Selection</h3>
                        <select id="templateSelect">
                            <option value="">Select a template...</option>
                        </select>
                        <textarea id="promptTemplate" class="template-textarea" placeholder="Template will appear here..." readonly></textarea>
                        
                        <div class="enhancers-section">
                            <h3>Template Enhancers</h3>
                            <div class="enhancer-grid">
                                <div class="enhancer-field">
                                    <label>Content Block</label>
                                    <textarea class="enhancer-input" id="content-block" placeholder="Main subject or focus"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Style Theme</label>
                                    <textarea class="enhancer-input" id="style-theme" placeholder="Overall style or theme"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Medium/Technique</label>
                                    <textarea class="enhancer-input" id="medium-technique" placeholder="Art medium or technique"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Color Palette</label>
                                    <textarea class="enhancer-input" id="color-palette" placeholder="Color scheme"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Mood/Tone</label>
                                    <textarea class="enhancer-input" id="mood-tone" placeholder="Emotional tone or mood"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Environment</label>
                                    <textarea class="enhancer-input" id="environment-setting" placeholder="Scene or setting"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Lighting</label>
                                    <textarea class="enhancer-input" id="lighting" placeholder="Lighting style"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Composition</label>
                                    <textarea class="enhancer-input" id="composition" placeholder="Layout and framing"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Artist References</label>
                                    <textarea class="enhancer-input" id="artist-references" placeholder="Artist styles to reference"></textarea>
                                </div>
                                <div class="enhancer-field">
                                    <label>Whitespace Hint</label>
                                    <textarea class="enhancer-input" id="whitespace-hint" placeholder="Spacing and layout hints"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="copywriter-section">
                            <label for="copywriterBrief">Marketing Brief / Copywriter Content</label>
                            <textarea id="copywriterBrief" rows="8" placeholder="Paste marketing brief or copywriter content here..."></textarea>
                        </div>
                        
                    </div>
                    <div class="content-card">
                        <div class="output-header">
                            <h3>Output Preview</h3>
                            <select id="prompt-count">
                                <option value="1">1 Prompt</option>
                                <option value="3" selected>3 Prompts</option>
                                <option value="5">5 Prompts</option>
                                <option value="10">10 Prompts</option>
                                <option value="15">15 Prompts</option>
                                <option value="20">20 Prompts</option>
                            </select>
                        </div>
                        <textarea id="outputPreview" class="preview-textarea" readonly placeholder="Generated prompt will appear here..."></textarea>
                        
                        <button id="generate-image-prompts" class="generate-prompts-button">
                            Generate Image Prompts...
                        </button>
                    </div>
                </div>
                
                <!-- Prompt Importer module -->
                <div id="prompt-importer-module" class="module-content">
                    <div class="module-header">
                        <h2>📥 Prompt Importer</h2>
                    </div>
                    <div class="content-card">
                        <h3>Import Prompts from External Sources</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5em;">
                            Import prompts from ChatGPT, JSON files, or any text format. Parsed prompts will be processed with your current Midjourney parameters and sent to the Prompt Generation module.
                        </p>
                        
                        <div class="importer-container">
                            <div class="import-input-section">
                                <label for="prompt-import">Paste JSON, raw prompts, or ChatGPT output:</label>
                                <textarea 
                                    id="prompt-import" 
                                    placeholder='Paste prompts in any format:

JSON: {"prompts": ["prompt 1", "prompt 2"]}
Raw: One prompt per line
ChatGPT: Copy/paste ChatGPT response with prompts

Example ChatGPT output:
1. A futuristic cityscape with neon lighting
2. Vintage bookstore interior with warm ambiance
3. Abstract geometric pattern in blue and gold'
                                    rows="12"
                                ></textarea>
                                
                                <div class="import-controls">
                                    <button id="parse-prompts-btn" class="primary-btn">🔍 Parse Prompts</button>
                                    <button id="clear-import-btn" class="secondary-btn">🗑️ Clear</button>
                                    <span id="import-status" class="import-status"></span>
                                </div>
                            </div>
                            
                            <div class="import-preview-section" id="import-preview" style="display: none;">
                                <h3>📋 Parsed Prompts Preview</h3>
                                <div id="parsed-prompts-list"></div>
                                <div class="import-actions">
                                    <button id="import-prompts-btn" class="success-btn">✅ Send to Prompt Generation</button>
                                    <button id="cancel-import-btn" class="secondary-btn">❌ Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Chat Assistant module -->
                <div id="ai-chat-assistant-module" class="module-content">
                    <div class="module-header">
                        <h2><i class="fas fa-robot"></i> AI Chat Assistant</h2>
                        <div class="chat-controls">
                            <select id="chat-template-mode" class="model-selector">
                                <option value="freeform" selected>Freeform (No Template)</option>
                                <option value="current-template">Use Current Template</option>
                                <option value="general">General Prompts</option>
                            </select>
                            <select id="chat-template-select" class="model-selector" style="display: none;">
                                <option value="">Select Template...</option>
                            </select>
                            <button id="history-chat-btn" class="secondary-btn chat-history-btn"><i class="fas fa-history"></i> History</button>
                            <button id="clear-chat-btn" class="primary-btn" style="background: var(--accent-color); color: white;" title="Start a fresh conversation to avoid accumulating token costs"><i class="fas fa-plus-circle"></i> New Chat</button>
                        </div>
                    </div>
                    
                    <div class="chat-container">
                        <div class="chat-messages" id="chat-messages">
                            <div class="chat-message assistant-message welcome-message">
                                <div class="message-avatar">🤖</div>
                                <div class="message-content">
                                    <div class="message-text">
                                        Hi! I'm your AI prompt generation assistant. I can help you create Midjourney prompts through natural conversation.
                                        <br><br>
                                        Try asking me things like:
                                        <ul>
                                            <li>"Create 5 prompts for a cyberpunk city"</li>
                                            <li>"I need prompts for product photography"</li>
                                            <li>"Make prompts more artistic and dreamy"</li>
                                        </ul>
                                        <strong>Template Mode:</strong> Use the dropdown above to control whether I consider your current template or generate freeform prompts.
                                        <br><br>
                                        <strong>Import Feature:</strong> I'll automatically detect prompts in my responses and offer to import them to your Prompt Generation module!
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chat-input-container">
                            <div class="chat-input-wrapper">
                                <button id="file-upload-btn" class="file-upload-btn" title="Upload image or text file">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <input type="file" id="file-input" accept="image/*,.txt,.md,.json" style="display: none;">
                                <textarea 
                                    id="chat-input" 
                                    placeholder="Ask me to generate prompts, refine ideas, or help with creative direction... (Ctrl+V to paste images)"
                                    rows="3"
                                ></textarea>
                                <button id="send-chat-btn" class="send-btn" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div class="file-preview" id="file-preview" style="display: none;"></div>
                            <div class="chat-status" id="chat-status"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Prompt Generation module -->
                <div id="prompt-generation-module" class="module-content">
                    <!-- Split Pane Container (hidden by default) -->
                    <div id="split-pane-view" class="split-pane-container" style="display: none;">
                        <div class="split-pane-left">
                            <!-- Module content will be moved here dynamically -->
                            <div id="split-pane-content"></div>
                        </div>
                        <div class="split-pane-divider" id="split-pane-divider"></div>
                        <div class="split-pane-right">
                            <div class="iframe-header">
                                <div class="iframe-header-title">
                                    <i class="fas fa-external-link-alt"></i>
                                    <span id="iframe-service-name">Midjourney</span>
                                </div>
                                <div class="iframe-controls">
                                    <button class="iframe-control-btn" id="iframe-refresh-btn" title="Refresh">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button class="iframe-control-btn" id="iframe-home-btn" title="Go to Home">
                                        <i class="fas fa-home"></i>
                                    </button>
                                    <button class="iframe-control-btn" id="iframe-close-btn" title="Close Split View">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="iframe-container">
                                <div class="iframe-loading" id="iframe-loading">
                                    <i class="fas fa-spinner"></i>
                                    <span>Loading...</span>
                                </div>
                                <iframe id="service-iframe" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox" allow="clipboard-write"></iframe>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Normal View Container -->
                    <div id="normal-view-content">
                        <div class="module-header">
                            <h2>Prompt Generation</h2>
                        </div>
                        
                        <!-- Collapsible Parameters Section -->
                        <div class="content-card parameters-container">
                            <div class="parameters-header" id="parameters-header">
                                <div class="parameters-header-left">
                                    <i class="fas fa-chevron-right parameters-toggle-icon"></i>
                                    <span class="parameters-header-title">Midjourney Parameters</span>
                                    <div class="param-preview-compact" id="parameter-preview-compact">--ar 4:3 --stylize 200 --c 25 --style raw --relax --draft --v 7</div>
                                </div>
                                <button class="parameters-edit-btn" id="parameters-edit-btn">
                                    <i class="fas fa-edit"></i> Edit Parameters
                                </button>
                            </div>
                            
                            <div class="parameters-content" id="parameters-content">
                                <div class="params-grid">
                            <div class="param-field">
                                <label>Aspect Ratio</label>
                                <select id="aspect-ratio">
                                    <option value="--ar 4:3" selected>4:3 Standard</option>
                                    <option value="--ar 1:1">1:1 Square</option>
                                    <option value="--ar 16:9">16:9 Widescreen</option>
                                    <option value="--ar 9:16">9:16 Portrait</option>
                                    <option value="--ar 3:2">3:2 Photo</option>
                                    <option value="--ar 2:3">2:3 Tall</option>
                                </select>
                            </div>
                            <div class="param-field">
                                <label>Stylize</label>
                                <select id="stylize-value">
                                    <option value="--stylize 100">100 (Default)</option>
                                    <option value="--stylize 200" selected>200 (Artistic)</option>
                                    <option value="--stylize 500">500 (Enhanced)</option>
                                    <option value="--stylize 750">750 (Strong)</option>
                                    <option value="--stylize 1000">1000 (Maximum)</option>
                                </select>
                            </div>
                            <div class="param-field">
                                <label>Chaos</label>
                                <select id="chaos-value">
                                    <option value="">0 (Default)</option>
                                    <option value="--c 25" selected>25 (Subtle)</option>
                                    <option value="--c 50">50 (Varied)</option>
                                    <option value="--c 75">75 (Wild)</option>
                                    <option value="--c 100">100 (Maximum)</option>
                                </select>
                            </div>
                            <div class="param-field">
                                <label>Style Version</label>
                                <select id="style-version">
                                    <option value="--style raw" selected>Raw (Default)</option>
                                    <option value="--style standard">Standard</option>
                                </select>
                            </div>
                            <div class="param-field">
                                <label>Speed</label>
                                <select id="speed-value">
                                    <option value="--turbo">Turbo</option>
                                    <option value="--fast">Fast</option>
                                    <option value="--relax" selected>Relax</option>
                                </select>
                            </div>
                            <div class="param-field">
                                <label>Mode</label>
                                <select id="mode-value">
                                    <option value="--draft" selected>Draft</option>
                                    <option value="--standard">Standard</option>
                                </select>
                            </div>
                            <div class="param-field">
                                <label>Version</label>
                                <select id="version-value">
                                    <option value="--v 7" selected>v7</option>
                                    <option value="--v 6.1">v6.1</option>
                                    <option value="--v 6">v6</option>
                                </select>
                            </div>
                            <div class="param-field" style="grid-column: span 2;">
                                <label>Exclude Elements (--no)</label>
                                <input
                                    type="text"
                                    id="no-value"
                                    placeholder="Enter words to exclude, separated by commas"
                                />
                            </div>
                            <div class="param-field">
                                <label>Style Weight (--sw)</label>
                                <select id="style-weight-value">
                                    <option value="">None</option>
                                    <option value="--sw 0">0 (No style influence)</option>
                                    <option value="--sw 50">50 (Low influence)</option>
                                    <option value="--sw 100">100 (Default)</option>
                                    <option value="--sw 200">200 (Medium influence)</option>
                                    <option value="--sw 500">500 (High influence)</option>
                                    <option value="--sw 750">750 (Very high influence)</option>
                                    <option value="--sw 1000">1000 (Maximum influence)</option>
                                </select>
                            </div>
                        </div>
                        <div class="param-preview" id="parameter-preview">No parameters selected</div>
                    </div>
                    </div>
                    
                    <div class="content-card">
                        <h3>Generated Prompts</h3>
                        <div class="prompts-wrapper" style="position: relative; z-index: 4;">
                            <div class="loading-overlay" style="display: none;">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">Generating prompts...</div>
                            </div>
                            <div id="generatedPrompts" class="prompt-list"></div>
                        </div>
                        <div class="batch-actions" style="margin-top: 20px;">
                            <div class="batch-send-label">Batch Send All Prompts:</div>
                            <button id="close-midjourney-browser-btn" class="action-button" style="background-color: #555;">
                                <i class="fas fa-times-circle"></i> Close MJ Browser
                            </button>
                            <button id="close-ideogram-browser-btn" class="action-button" style="background-color: #555;">
                                <i class="fas fa-times-circle"></i> Close IG Browser
                            </button>
                            <button id="send-all-ideogram-btn" class="action-button ideogram-btn">
                                <i class="fas fa-image"></i> Send All to Ideogram
                            </button>
                            <button id="send-all-midjourney-btn" class="action-button midjourney-btn">
                                <i class="fas fa-robot"></i> Send All to Midjourney
                            </button>
                        </div>
                        
                        <!-- Status Console -->
                        <div id="batch-status-console" style="display: none; margin-top: 16px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 12px; font-family: 'Monaco', 'Courier New', monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #333;">
                                <span style="color: #4CAF50; font-weight: bold;">
                                    <i class="fas fa-terminal"></i> Batch Status
                                </span>
                                <span id="status-progress" style="color: #888; font-size: 11px;">Ready</span>
                            </div>
                            <div id="status-log" style="color: #aaa; line-height: 1.6;">
                                <!-- Status messages will appear here -->
                            </div>
                        </div>
                    </div>
                    </div> <!-- Close normal-view-content -->
                </div>
                
                <!-- Settings module -->
                <div id="settings-module" class="module-content">
                    <div class="module-header">
                        <h2>Settings</h2>
                    </div>
                    <div class="content-card">
                        <h3>User Profile</h3>
                        <div id="profile-info">
                            <div class="setting-group">
                                <label class="setting-label">Name</label>
                                <div class="setting-control" id="profile-name-display"></div>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">Email</label>
                                <div class="setting-control" id="profile-email-display"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <h3>OpenRouter API Key</h3>
                        <div class="setting-description" style="margin-bottom: 16px; color: #aaa; font-size: 14px;">
                            Add your OpenRouter API key to enable AI chat features and view credit balance in real-time. 
                            Get your key from <a href="https://openrouter.ai/keys" target="_blank" style="color: #667eea;">openrouter.ai/keys</a>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">API Key</label>
                            <div class="setting-control" style="display: flex; gap: 8px; align-items: center;">
                                <input 
                                    type="password" 
                                    id="openrouter-api-key-input" 
                                    placeholder="sk-or-v1-..." 
                                    style="flex: 1; padding: 10px; background: #2a2f3f; border: 1px solid #3a3f4f; border-radius: 4px; color: #fff; font-family: 'Courier New', monospace; font-size: 13px;"
                                />
                                <button 
                                    id="toggle-api-key-visibility" 
                                    class="action-button" 
                                    style="padding: 10px 14px; background: #2a2f3f;"
                                    title="Show/Hide API Key"
                                >
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button 
                                    id="save-openrouter-api-key" 
                                    class="action-button" 
                                    style="padding: 10px 16px;"
                                >
                                    <i class="fas fa-save"></i> Save Key
                                </button>
                            </div>
                            <div id="openrouter-key-status" class="status-message" style="font-size: 13px; color: #888; margin-top: 8px;">
                                <!-- Status messages will appear here -->
                            </div>
                        </div>
                        <div class="setting-group" style="margin-top: 16px;">
                            <div style="background: #2a2f3f; padding: 12px; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div style="font-size: 13px; color: #aaa; line-height: 1.6;">
                                    <strong style="color: #fff;">🔒 Privacy & Security:</strong><br>
                                    • Your API key is encrypted and stored securely in the database<br>
                                    • Only you can access your key - it's never shared with other users<br>
                                    • The key is used server-side for OpenRouter API calls<br>
                                    • You can remove your key anytime by clearing the field and saving
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <h3>Generator Authentication</h3>
                        <div class="setting-description" style="margin-bottom: 24px; color: #aaa; font-size: 14px;">
                            Set up browser automation for Midjourney and Ideogram. You'll need to log in once manually, then your session will be saved for future use.
                        </div>
                        
                        <!-- Midjourney Authentication -->
                        <div class="setting-group" style="border-bottom: 1px solid #2a2f3f; padding-bottom: 20px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <label class="setting-label" style="margin: 0;">Midjourney</label>
                                    <span id="mj-auth-indicator" class="auth-indicator not-authenticated" style="font-size: 20px; line-height: 1;">●</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button id="mj-setup-btn" class="action-button" style="padding: 6px 12px; font-size: 13px;">
                                        <i class="fas fa-key"></i> Setup Login
                                    </button>
                                    <button id="mj-status-btn" class="action-button" style="padding: 6px 12px; font-size: 13px; background: #2a2f3f;">
                                        <i class="fas fa-sync"></i> Check Status
                                    </button>
                                </div>
                            </div>
                            <div id="mj-auth-status" class="status-message" style="font-size: 13px; color: #888;">
                                Click "Setup Login" to authenticate with Midjourney
                            </div>
                        </div>
                        
                        <!-- Ideogram Authentication -->
                        <div class="setting-group">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <label class="setting-label" style="margin: 0;">Ideogram</label>
                                    <span id="ideogram-auth-indicator" class="auth-indicator not-authenticated" style="font-size: 20px; line-height: 1;">●</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button id="ideogram-setup-btn" class="action-button" style="padding: 6px 12px; font-size: 13px;">
                                        <i class="fas fa-key"></i> Setup Login
                                    </button>
                                    <button id="ideogram-status-btn" class="action-button" style="padding: 6px 12px; font-size: 13px; background: #2a2f3f;">
                                        <i class="fas fa-sync"></i> Check Status
                                    </button>
                                </div>
                            </div>
                            <div id="ideogram-auth-status" class="status-message" style="font-size: 13px; color: #888;">
                                Click "Setup Login" to authenticate with Ideogram
                            </div>
                        </div>
                    </div>
                    <div class="content-card">
                        <h3>Preferences</h3>
                        <div class="setting-group">
                            <!-- <label class="setting-label">
                                <span>Browser Preference</span>
                                <div class="setting-description">Choose where to open Midjourney and Ideogram links</div>
                            </label>
                            <div class="setting-control">
                                <select id="browser-preference" class="setting-select">
                                    <option value="external">External Browser (default system browser)</option>
                                </select>
                            </div> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Profile Selector Modal -->
    <div id="profile-selector-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:10000; align-items:center; justify-content:center;">
        <div style="background:#363636; padding:24px; border-radius:8px; min-width:700px; max-width:90vw; max-height:80vh; margin:auto; position:relative; overflow-y:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="color:#fff; margin:0;">Select Profiles & Style References</h3>
                <button type="button" id="close-profile-selector" style="background:none; border:none; color:#ccc; font-size:20px; cursor:pointer;">&times;</button>
            </div>
            
            <div style="margin-bottom:16px;">
                <div style="color:#ccc; font-size:14px; margin-bottom:8px;">Click to select/deselect profiles. Multiple selections will be combined in your prompts.</div>
                <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
                    <button type="button" id="clear-all-profiles" class="action-button" style="padding:4px 8px; font-size:12px;">Clear All</button>
                    <div style="color:#aaa; font-size:12px;">
                        <span style="display:inline-flex; align-items:center; gap:4px; margin-right:12px;">
                            <div style="width:12px; height:12px; background:#4a90e2; border-radius:50%;"></div>
                            --p Profile
                        </span>
                        <span style="display:inline-flex; align-items:center; gap:4px;">
                            <div style="width:12px; height:12px; background:#5cb85c; border-radius:50%;"></div>
                            --sref Style
                        </span>
                    </div>
                </div>
            </div>
            
            <div id="profile-selector-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(120px, 1fr)); gap:12px; max-height:400px; overflow-y:auto; padding:8px;">
            </div>
            
            <div style="text-align:right; border-top:1px solid #555; padding-top:16px; margin-top:16px;">
                <span id="selector-selected-count" style="color:#aaa; font-size:12px; margin-right:16px;">0 selected</span>
                <button type="button" id="apply-profile-selection" class="action-button">Apply Selection</button>
            </div>
        </div>
    </div>
    
    <!-- Modal for Add/Edit Profile -->
    <div id="profile-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
        <div style="background:#363636; padding:24px; border-radius:8px; min-width:500px; max-width:90vw; margin:auto; position:relative;">
            <h3 id="profile-modal-title">Add Profile</h3>
            <form id="profile-form">
                <label for="profile-name">Profile Name</label>
                <input type="text" id="profile-name" required style="width:100%; padding:8px; margin-bottom:12px; border:1px solid #ccc; border-radius:4px; font-size:14px;">
                
                <label style="display:block; margin-bottom:4px; font-weight:bold;">Profile Type</label>
                <div style="margin-bottom:12px; display:flex; gap:20px;">
                    <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                        <input type="radio" id="profile-type-p" name="profile-type" value="profile" checked>
                        <i class="fas fa-user" style="color:#4a90e2;"></i>
                        <span style="color:#fff;">--p Profile (Personal Style)</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                        <input type="radio" id="profile-type-sref" name="profile-type" value="sref">
                        <i class="fas fa-palette" style="color:#5cb85c;"></i>
                        <span style="color:#fff;">--sref Style Code (Style Reference)</span>
                    </label>
                </div>
                
                <label for="profile-id" id="profile-id-label">Profile ID</label>
                <input type="text" id="profile-id" required style="width:100%; padding:8px; margin-bottom:12px; border:1px solid #ccc; border-radius:4px; font-size:14px;" placeholder="e.g., myprofile1">
                
                <div id="thumbnail-preview" style="display:none; margin-bottom:12px; text-align:center;">
                    <div style="color:#ccc; font-size:12px; margin-bottom:6px;">Current Thumbnail:</div>
                    <img id="thumbnail-preview-image" style="max-width:100px; max-height:100px; border-radius:6px; border:1px solid #555; object-fit:cover;">
                </div>
                
                <label for="profile-thumbnail" style="display:block; margin-bottom:4px; font-weight:bold;">Thumbnail Image</label>
                <div style="margin-bottom:12px;">
                    <input type="text" id="profile-thumbnail" placeholder="Enter image URL..." style="width:100%; padding:10px; border:1px solid #ccc; border-radius:4px; font-size:14px; margin-bottom:8px;">
                </div>
                
                <label for="profile-description">Description</label>
                <textarea id="profile-description" style="width:100%; padding:8px; margin-bottom:12px; border:1px solid #ccc; border-radius:4px; font-size:14px; min-height:60px; resize:vertical;"></textarea>
                
                <div style="text-align:right; border-top:1px solid #eee; padding-top:16px; margin-top:16px;">
                    <button type="button" id="profile-cancel" class="action-button" style="margin-right:8px; background:#6c757d;">Cancel</button>
                    <button type="submit" class="action-button">Save Profile</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Load Logger first (secure environment-aware logging) -->
    <script src="/js/logger.js"></script>
    
    <!-- OLD SYSTEM: Load Global AI Model Selector (DISABLED - using TopNavModelSelector with 3 curated models instead) -->
    <!-- <script src="/js/global-ai-model.js"></script> -->
    
    <!-- Load Top Nav Model Selector -->
    <script src="/js/components/top-nav-model-selector.js"></script>
    
    <!-- Load HAL 9000 Messages for auth screen -->
    <script src="/js/hal-messages.js"></script>
    
    <!-- Load IPC Adapter (converts Electron IPC to browser APIs) -->
    <script src="/js/ipc-adapter.js"></script>
    
    <!-- Load Browser Send Shim (provides send functions for web app) -->
    <script src="/js/browser-send-shim.js"></script>
    
    <!-- Load core dependencies -->
    <script src="/js/config.js"></script>
    <script src="/js/utils.js"></script>
    
    <!-- Load API layer for authentication -->
    <script src="/js/api.js"></script>
    
    <!-- Load app modules -->
    <script src="/js/local-bridge-client.js"></script>
    <script src="/js/local-bridge-ui.js"></script>
    <script src="/js/global-model-sync.js"></script>
    <script src="/js/hooks.js"></script>
    <script src="/js/midjourney-handler.js"></script>
    <script src="/js/generator.js"></script>
    <script src="/js/parameter-ui.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- Load feature modules -->
    <script src="/js/template-suggestions.js"></script>
    <script src="/js/prompt-importer.js"></script>
    <script src="/js/prompt-history.js"></script>
    <script src="/js/ai-chat.js"></script>
    <script src="/js/auth-manager.js"></script>
    <script src="/js/template-builder.js"></script>
    <script src="/js/generator-settings.js"></script>
    <script src="/js/openrouter-key-manager.js"></script>
</body>
</html>
